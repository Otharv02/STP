<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sales Form</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
    }
    
    .header {
      background-color: #c8c6e2;
      padding: 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .company-name {
      font-size: 24px;
      color: #333;
    }
    
    .nav-links a {
      margin-left: 15px;
      text-decoration: none;
      color: #333;
      font-weight: bold;
    }
    
    .nav-links a:hover {
      text-decoration: underline;
    }
    
    .content {
      padding: 20px;
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .form-title {
      font-size: 24px;
      margin-bottom: 20px;
    }
    
    .form-container {
      background-color: #f9f9f9;
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 20px;
    }
    
    .form-section {
      margin-bottom: 20px;
    }
    
    .form-section-title {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 15px;
      padding-bottom: 5px;
      border-bottom: 1px solid #ddd;
    }
    
    .form-row {
      display: flex;
      flex-wrap: wrap;
      margin-bottom: 15px;
    }
    
    .form-group {
      flex: 1;
      min-width: 200px;
      margin-right: 15px;
      margin-bottom: 10px;
    }
    
    .form-group:last-child {
      margin-right: 0;
    }
    
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }
    
    input[type="text"],
    input[type="tel"],
    input[type="number"],
    input[type="date"],
    textarea,
    select {
      width: 100%;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
    }
    
    textarea {
      height: 80px;
      resize: vertical;
    }
    
    .items-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
    }
    
    .items-table th,
    .items-table td {
      padding: 10px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }
    
    .items-table th {
      background-color: #f2f2f2;
    }
    
    .items-table input,
    .items-table select {
      width: 100%;
      padding: 6px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
    }
    
    .add-row-btn {
      background-color: #4CAF50;
      color: white;
      border: none;
      padding: 8px 16px;
      text-align: center;
      text-decoration: none;
      display: inline-block;
      font-size: 14px;
      margin: 4px 2px;
      cursor: pointer;
      border-radius: 4px;
    }
    
    .remove-row-btn {
      background-color: #f44336;
      color: white;
      border: none;
      padding: 6px;
      text-align: center;
      text-decoration: none;
      display: inline-block;
      font-size: 12px;
      margin: 2px;
      cursor: pointer;
      border-radius: 4px;
      width: 24px;
      height: 24px;
      line-height: 1;
    }
    
    .form-footer {
      display: flex;
      justify-content: space-between;
      margin-top: 30px;
    }
    
    .totals-section {
      flex: 0 0 300px;
      text-align: right;
    }
    
    .total-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
    }
    
    .total-row:last-child {
      font-weight: bold;
      font-size: 18px;
      padding-top: 5px;
      border-top: 1px solid #ddd;
    }
    
    .total-label {
      margin-right: 10px;
    }
    
    .btn-submit {
      background-color: #3f51b5;
      color: white;
      border: none;
      padding: 10px 20px;
      text-align: center;
      text-decoration: none;
      display: inline-block;
      font-size: 16px;
      margin: 4px 2px;
      cursor: pointer;
      border-radius: 4px;
    }
    
    .btn-submit:hover {
      background-color: #303f9f;
    }
  </style>
</head>
<body>
  <div class="header">
    <div class="company-name">Company</div>
    <div class="nav-links">
      <a href="/">Home</a>
      <a href="/sales">Sales Form</a>
      <a href="/dashboard">Dashboard</a>
    </div>
  </div>
  
  <div class="content">
    <h1 class="form-title">Sales Invoice</h1>
    
    <form action="/submit" method="post" class="form-container">
      <div class="form-section">
        <div class="form-section-title">Customer Information</div>
        <div class="form-row">
          <div class="form-group">
            <label for="name">Customer Name</label>
            <input type="text" id="name" name="name" required>
          </div>
          <div class="form-group">
            <label for="phone">Phone</label>
            <input type="tel" id="phone" name="phone">
          </div>
          <div class="form-group">
            <label for="order_by">Order By</label>
            <input type="text" id="order_by" name="order_by">
          </div>
        </div>
      </div>
      
      <div class="form-section">
        <div class="form-section-title">Invoice Details</div>
        <div class="form-row">
          <div class="form-group">
            <label for="invoice_number">Invoice Number</label>
            <input type="text" id="invoice_number" name="invoice_number" value="{{ invoice_number }}" readonly>
          </div>
          <div class="form-group">
            <label for="invoice_date">Invoice Date</label>
            <input type="date" id="invoice_date" name="invoice_date" required>
          </div>
          <div class="form-group">
            <label for="due_date">Due Date</label>
            <input type="date" id="due_date" name="due_date">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group" style="flex: 1 0 100%;">
            <label for="reference">Reference / Notes</label>
            <textarea id="reference" name="reference"></textarea>
          </div>
        </div>
      </div>
      
      <div class="form-section">
        <div class="form-section-title">Items</div>
        <table class="items-table" id="items-table">
          <thead>
            <tr>
              <th>Item Code</th>
              <th>Category</th>
              <th>Description</th>
              <th>Quantity</th>
              <th>Unit</th>
              <th>Price</th>
              <th>Amount</th>
              <th></th>
            </tr>
          </thead>
          <tbody id="items-body">
            <tr>
              <td><input type="text" name="item_code_1" required></td>
              <td><input type="text" name="category_1"></td>
              <td><input type="text" name="description_1"></td>
              <td><input type="number" name="quantity_1" value="1" min="1" step="any" class="quantity"></td>
              <td><input type="text" name="unit_1" value="Ea"></td>
              <td><input type="number" name="price_1" value="0.00" min="0" step="0.01" class="price"></td>
              <td><input type="number" name="amount_1" value="0.00" readonly class="amount"></td>
              <td><button type="button" class="remove-row-btn" disabled>×</button></td>
            </tr>
          </tbody>
        </table>
        <button type="button" class="add-row-btn" id="add-row">+ Add Item</button>
        <input type="hidden" id="total_rows" name="total_rows" value="1">
      </div>
      
      <div class="form-footer">
        <div></div>
        <div class="totals-section">
          <div class="total-row">
            <span class="total-label">Subtotal:</span>
            <span id="subtotal">0.00</span>
          </div>
          <div class="total-row">
            <span class="total-label">Round Off:</span>
            <input type="number" id="round_off" name="round_off" value="0.00" step="0.01">
          </div>
          <div class="total-row">
            <span class="total-label">Total:</span>
            <span id="total">0.00</span>
            <input type="hidden" name="total" id="total_input" value="0.00">
          </div>
        </div>
      </div>
      
      <div style="text-align: center; margin-top: 20px;">
        <button type="submit" class="btn-submit">Save Invoice</button>
      </div>
    </form>
  </div>
  
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Set default dates
      const today = new Date();
      const invoiceDate = document.getElementById('invoice_date');
      const dueDate = document.getElementById('due_date');
      
      // Format date as YYYY-MM-DD
      const formatDate = (date) => {
        const d = new Date(date);
        let month = '' + (d.getMonth() + 1);
        let day = '' + d.getDate();
        const year = d.getFullYear();
        
        if (month.length < 2) month = '0' + month;
        if (day.length < 2) day = '0' + day;
        
        return [year, month, day].join('-');
      };
      
      // Set today as invoice date
      invoiceDate.value = formatDate(today);
      
      // Set due date as 30 days from today
      const thirtyDaysLater = new Date(today);
      thirtyDaysLater.setDate(today.getDate() + 30);
      dueDate.value = formatDate(thirtyDaysLater);
      
      // Add row functionality
      const addRowBtn = document.getElementById('add-row');
      const itemsBody = document.getElementById('items-body');
      const totalRowsInput = document.getElementById('total_rows');
      
      addRowBtn.addEventListener('click', function() {
        const rowCount = itemsBody.children.length + 1;
        totalRowsInput.value = rowCount;
        
        const newRow = document.createElement('tr');
        newRow.innerHTML = `
          <td><input type="text" name="item_code_${rowCount}" required></td>
          <td><input type="text" name="category_${rowCount}"></td>
          <td><input type="text" name="description_${rowCount}"></td>
          <td><input type="number" name="quantity_${rowCount}" value="1" min="1" step="any" class="quantity"></td>
          <td><input type="text" name="unit_${rowCount}" value="Ea"></td>
          <td><input type="number" name="price_${rowCount}" value="0.00" min="0" step="0.01" class="price"></td>
          <td><input type="number" name="amount_${rowCount}" value="0.00" readonly class="amount"></td>
          <td><button type="button" class="remove-row-btn">×</button></td>
        `;
        
        itemsBody.appendChild(newRow);
        
        // Enable all remove buttons when there's more than one row
        if (rowCount > 1) {
          const removeButtons = document.querySelectorAll('.remove-row-btn');
          removeButtons.forEach(btn => {
            btn.disabled = false;
          });
        }
        
        // Add event listeners to new row
        addRowEventListeners(newRow);
        
        // Update totals
        updateTotals();
      });
      
      // Function to add event listeners to a row
      function addRowEventListeners(row) {
        const quantityInput = row.querySelector('.quantity');
        const priceInput = row.querySelector('.price');
        const amountInput = row.querySelector('.amount');
        const removeBtn = row.querySelector('.remove-row-btn');
        
        // Calculate amount when quantity or price changes
        quantityInput.addEventListener('input', function() {
          amountInput.value = (parseFloat(quantityInput.value) * parseFloat(priceInput.value)).toFixed(2);
          updateTotals();
        });
        
        priceInput.addEventListener('input', function() {
          amountInput.value = (parseFloat(quantityInput.value) * parseFloat(priceInput.value)).toFixed(2);
          updateTotals();
        });
        
        // Remove row when button is clicked
        removeBtn.addEventListener('click', function() {
          row.remove();
          
          // Update row indices
          const rows = itemsBody.querySelectorAll('tr');
          
          // Update total_rows input
          totalRowsInput.value = rows.length;
          
          // Disable remove button if only one row remains
          if (rows.length === 1) {
            rows[0].querySelector('.remove-row-btn').disabled = true;
          }
          
          // Update totals
          updateTotals();
        });
      }
      
      // Add event listeners to existing rows
      const existingRows = itemsBody.querySelectorAll('tr');
      existingRows.forEach(row => {
        addRowEventListeners(row);
      });
      
      // Function to update totals
      function updateTotals() {
        const amounts = document.querySelectorAll('.amount');
        const subtotalElem = document.getElementById('subtotal');
        const roundOffInput = document.getElementById('round_off');
        const totalElem = document.getElementById('total');
        const totalInput = document.getElementById('total_input');
        
        let subtotal = 0;
        
        amounts.forEach(amount => {
          subtotal += parseFloat(amount.value || 0);
        });
        
        subtotalElem.textContent = subtotal.toFixed(2);
        
        const roundOff = parseFloat(roundOffInput.value || 0);
        const total = subtotal + roundOff;
        
        totalElem.textContent = total.toFixed(2);
        totalInput.value = total.toFixed(2);
      }
      
      // Update totals when round off changes
      document.getElementById('round_off').addEventListener('input', updateTotals);
      
      // Initialize totals
      updateTotals();
    });
  </script>
</body>
</html>